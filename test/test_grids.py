"""Numerically verify quadrature generators
"""

import numpy as np
import pytest

from sound_field_analysis import gen, io


def test_lebedev_grid_NA_degree():
    with pytest.raises(ValueError):
        gen.lebedev(degree=1)


def test_lebedev_grid_NA_order():
    with pytest.raises(ValueError):
        gen.lebedev(max_order=12)


def test_lebedev_grid_NA():
    with pytest.raises(ValueError):
        gen.lebedev()


def test_lebedev_grid_0_order_fallback():
    # fmt: off
    lebedev_grid_1 = io.SphericalGrid(
        azimuth=np.array([0., 0., 0., 1.5707963267948966, 3.1415926535897931, 4.7123889803846897]),
        colatitude=np.array([0., 1.5707963267948966, 3.1415926535897931, 1.5707963267948966, 1.5707963267948966, 1.5707963267948966]),
        radius=np.array([1., 1., 1., 1., 1., 1.]),
        weight=np.array([0.1666666666666667, 0.1666666666666667, 0.1666666666666667, 0.1666666666666667, 0.1666666666666667, 0.1666666666666667])
    )
    # fmt: on
    np.testing.assert_allclose(gen.lebedev(max_order=0), lebedev_grid_1)


def test_lebedev_grid_194():
    # fmt: off
    lebedev_grid_194 = io.SphericalGrid(
        azimuth=np.array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.1314224389344013, 0.1314224389344013, 0.1879869008650734, 0.1879869008650734, 0.2940860780003485, 0.2940860780003485, 0.3069605019034988, 0.3069605019034988, 0.3530595115392992, 0.4377579511459067, 0.4377579511459067, 0.5195449866495595, 0.5195449866495595, 0.5608291557018665, 0.5608291557018665, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 0.7853981633974483, 1.00996717109303, 1.00996717109303, 1.0512513401453372, 1.0512513401453372, 1.1330383756489899, 1.1330383756489899, 1.2177368152555974, 1.2638358248913979, 1.2638358248913979, 1.2767102487945481, 1.2767102487945481, 1.3828094259298231, 1.3828094259298231, 1.4393738878604954, 1.4393738878604954, 1.5707963267948966, 1.5707963267948966, 1.5707963267948966, 1.5707963267948966, 1.5707963267948966, 1.5707963267948966, 1.5707963267948966, 1.702218765729298, 1.702218765729298, 1.75878322765997, 1.75878322765997, 1.864882404795245, 1.864882404795245, 1.8777568286983954, 1.8777568286983954, 1.9238558383341959, 2.0085542779408034, 2.0085542779408034, 2.0903413134444562, 2.0903413134444562, 2.1316254824967631, 2.1316254824967631, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.3561944901923448, 2.5807634978879266, 2.5807634978879266, 2.6220476669402339, 2.6220476669402339, 2.7038347024438867, 2.7038347024438867, 2.7885331420504942, 2.8346321516862942, 2.8346321516862942, 2.8475065755894446, 2.8475065755894446, 2.9536057527247199, 2.9536057527247199, 3.0101702146553921, 3.0101702146553921, 3.1415926535897931, 3.1415926535897931, 3.1415926535897931, 3.1415926535897931, 3.1415926535897931, 3.1415926535897931, 3.1415926535897931, 3.2730150925241941, 3.2730150925241941, 3.3295795544548663, 3.3295795544548663, 3.4356787315901416, 3.4356787315901416, 3.448553155493292, 3.448553155493292, 3.494652165129092, 3.5793506047356995, 3.5793506047356995, 3.6611376402393523, 3.6611376402393523, 3.7024218092916596, 3.7024218092916596, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 3.9269908169872414, 4.1515598246828231, 4.1515598246828231, 4.1928439937351296, 4.1928439937351296, 4.2746310292387832, 4.2746310292387832, 4.3593294688453899, 4.4054284784811912, 4.4054284784811912, 4.4183029023843412, 4.4183029023843412, 4.524402079519616, 4.524402079519616, 4.5809665414502883, 4.5809665414502883, 4.7123889803846897, 4.7123889803846897, 4.7123889803846897, 4.7123889803846897, 4.7123889803846897, 4.7123889803846897, 4.7123889803846897, 4.8438114193190911, 4.8438114193190911, 4.9003758812497633, 4.9003758812497633, 5.0064750583850381, 5.0064750583850381, 5.0193494822881881, 5.0193494822881881, 5.0654484919239886, 5.1501469315305961, 5.1501469315305961, 5.2319339670342488, 5.2319339670342488, 5.2732181360865562, 5.2732181360865562, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.497787143782138, 5.7223561514777197, 5.7223561514777197, 5.7636403205300271, 5.7636403205300271, 5.8454273560336798, 5.8454273560336798, 5.9301257956402873, 5.9762248052760878, 5.9762248052760878, 5.9890992291792378, 5.9890992291792378, 6.0951984063145126, 6.0951984063145126, 6.1517628682451848, 6.1517628682451848]),
        colatitude=np.array([0., 2.7885331420504942, 2.3561944901923448, 1.9238558383341957, 1.5707963267948966, 1.2177368152555974, 0.7853981633974483, 3.1415926535897931, 0.3530595115392992, 1.4404943707983893, 1.7010982827914038, 2.1236507622147109, 1.0179418913750822, 0.5807780340897879, 2.5608146195000052, 1.2773566640691283, 1.8642359895206648, 1.5707963267948966, 2.3067540874479739, 0.8348385661418192, 2.0316281581750033, 1.1099644954147898, 1.7305162597466104, 1.4110763938431827, 1.5707963267948966, 1.2511856323329762, 0.9553166181245093, 0.4214197634066907, 2.4614662316678615, 2.9567887484826221, 0.6801264219219316, 1.8904070212568169, 0.1848039051071708, 2.7201728901831022, 2.1862760354652839, 1.7305162597466104, 1.4110763938431827, 2.0316281581750033, 1.1099644954147898, 2.3067540874479739, 0.8348385661418192, 1.5707963267948966, 1.8642359895206648, 1.2773566640691283, 2.5608146195000052, 0.5807780340897879, 1.0179418913750822, 2.1236507622147109, 1.7010982827914038, 1.4404943707983893, 1.9238558383341957, 1.2177368152555974, 1.5707963267948966, 0.3530595115392992, 2.3561944901923448, 2.7885331420504942, 0.7853981633974483, 1.7010982827914038, 1.4404943707983893, 2.1236507622147109, 1.0179418913750822, 2.5608146195000052, 0.5807780340897879, 1.2773566640691283, 1.8642359895206648, 1.5707963267948966, 2.3067540874479739, 0.8348385661418192, 1.1099644954147898, 2.0316281581750033, 1.7305162597466104, 1.4110763938431827, 1.5707963267948966, 0.6801264219219316, 2.7201728901831022, 2.9567887484826221, 0.4214197634066907, 1.8904070212568169, 1.2511856323329762, 0.9553166181245093, 2.1862760354652839, 0.1848039051071708, 2.4614662316678615, 1.7305162597466104, 1.4110763938431827, 2.0316281581750033, 1.1099644954147898, 0.8348385661418192, 2.3067540874479739, 1.5707963267948966, 1.8642359895206648, 1.2773566640691283, 0.5807780340897879, 2.5608146195000052, 2.1236507622147109, 1.0179418913750822, 1.4404943707983893, 1.7010982827914038, 1.5707963267948966, 1.2177368152555974, 0.7853981633974483, 2.3561944901923448, 1.9238558383341957, 0.3530595115392992, 2.7885331420504942, 1.7010982827914038, 1.4404943707983893, 1.0179418913750822, 2.1236507622147109, 2.5608146195000052, 0.5807780340897879, 1.2773566640691283, 1.8642359895206648, 1.5707963267948966, 2.3067540874479739, 0.8348385661418192, 2.0316281581750033, 1.1099644954147898, 1.7305162597466104, 1.4110763938431827, 1.8904070212568169, 0.4214197634066907, 2.9567887484826221, 1.2511856323329762, 0.6801264219219316, 0.1848039051071708, 2.4614662316678615, 2.7201728901831022, 1.5707963267948966, 2.1862760354652839, 0.9553166181245093, 1.7305162597466104, 1.4110763938431827, 2.0316281581750033, 1.1099644954147898, 2.3067540874479739, 0.8348385661418192, 1.5707963267948966, 1.2773566640691283, 1.8642359895206648, 2.5608146195000052, 0.5807780340897879, 1.0179418913750822, 2.1236507622147109, 1.7010982827914038, 1.4404943707983893, 1.9238558383341957, 2.3561944901923448, 0.7853981633974483, 1.2177368152555974, 0.3530595115392992, 1.5707963267948966, 2.7885331420504942, 1.4404943707983893, 1.7010982827914038, 2.1236507622147109, 1.0179418913750822, 2.5608146195000052, 0.5807780340897879, 1.2773566640691283, 1.8642359895206648, 1.5707963267948966, 0.8348385661418192, 2.3067540874479739, 2.0316281581750033, 1.1099644954147898, 1.4110763938431827, 1.7305162597466104, 0.6801264219219316, 1.5707963267948966, 2.7201728901831022, 2.9567887484826221, 0.4214197634066907, 0.1848039051071708, 2.4614662316678615, 1.8904070212568169, 2.1862760354652839, 0.9553166181245093, 1.2511856323329762, 1.4110763938431827, 1.7305162597466104, 2.0316281581750033, 1.1099644954147898, 2.3067540874479739, 0.8348385661418192, 1.5707963267948966, 1.2773566640691283, 1.8642359895206648, 2.5608146195000052, 0.5807780340897879, 2.1236507622147109, 1.0179418913750822, 1.7010982827914038, 1.4404943707983893]),
        radius=np.ones(194),
        weight=np.array([0.0017823404472446, 0.0050518460646148, 0.0057169059499771, 0.0050518460646148, 0.0017823404472446, 0.0050518460646148, 0.0057169059499771, 0.0017823404472446, 0.0050518460646148, 0.0041067770281694, 0.0041067770281694, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0051582377118054, 0.0051582377118054, 0.0050518460646148, 0.005608704082588, 0.005608704082588, 0.0055187714672736, 0.0055187714672736, 0.0055302489162331, 0.0055302489162331, 0.0057169059499771, 0.005608704082588, 0.0055733831788487, 0.0051582377118054, 0.0055187714672736, 0.0041067770281694, 0.0055187714672736, 0.005608704082588, 0.0041067770281694, 0.0051582377118054, 0.0055733831788487, 0.0055302489162331, 0.0055302489162331, 0.0055187714672736, 0.0055187714672736, 0.005608704082588, 0.005608704082588, 0.0050518460646148, 0.0051582377118054, 0.0051582377118054, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0041067770281694, 0.0041067770281694, 0.0050518460646148, 0.0050518460646148, 0.0017823404472446, 0.0050518460646148, 0.0057169059499771, 0.0050518460646148, 0.0057169059499771, 0.0041067770281694, 0.0041067770281694, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0051582377118054, 0.0051582377118054, 0.0050518460646148, 0.005608704082588, 0.005608704082588, 0.0055187714672736, 0.0055187714672736, 0.0055302489162331, 0.0055302489162331, 0.0057169059499771, 0.0055187714672736, 0.0051582377118054, 0.0041067770281694, 0.0051582377118054, 0.005608704082588, 0.005608704082588, 0.0055733831788487, 0.0055733831788487, 0.0041067770281694, 0.0055187714672736, 0.0055302489162331, 0.0055302489162331, 0.0055187714672736, 0.0055187714672736, 0.005608704082588, 0.005608704082588, 0.0050518460646148, 0.0051582377118054, 0.0051582377118054, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0041067770281694, 0.0041067770281694, 0.0017823404472446, 0.0050518460646148, 0.0057169059499771, 0.0057169059499771, 0.0050518460646148, 0.0050518460646148, 0.0050518460646148, 0.0041067770281694, 0.0041067770281694, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0051582377118054, 0.0051582377118054, 0.0050518460646148, 0.005608704082588, 0.005608704082588, 0.0055187714672736, 0.0055187714672736, 0.0055302489162331, 0.0055302489162331, 0.005608704082588, 0.0051582377118054, 0.0041067770281694, 0.005608704082588, 0.0055187714672736, 0.0041067770281694, 0.0055187714672736, 0.0051582377118054, 0.0057169059499771, 0.0055733831788487, 0.0055733831788487, 0.0055302489162331, 0.0055302489162331, 0.0055187714672736, 0.0055187714672736, 0.005608704082588, 0.005608704082588, 0.0050518460646148, 0.0051582377118054, 0.0051582377118054, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0041067770281694, 0.0041067770281694, 0.0050518460646148, 0.0057169059499771, 0.0057169059499771, 0.0050518460646148, 0.0050518460646148, 0.0017823404472446, 0.0050518460646148, 0.0041067770281694, 0.0041067770281694, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0051582377118054, 0.0051582377118054, 0.0050518460646148, 0.005608704082588, 0.005608704082588, 0.0055187714672736, 0.0055187714672736, 0.0055302489162331, 0.0055302489162331, 0.0055187714672736, 0.0057169059499771, 0.0051582377118054, 0.0041067770281694, 0.0051582377118054, 0.0041067770281694, 0.0055187714672736, 0.005608704082588, 0.0055733831788487, 0.0055733831788487, 0.005608704082588, 0.0055302489162331, 0.0055302489162331, 0.0055187714672736, 0.0055187714672736, 0.005608704082588, 0.005608704082588, 0.0050518460646148, 0.0051582377118054, 0.0051582377118054, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0055302489162331, 0.0041067770281694, 0.0041067770281694])
    )
    # fmt: on
    np.testing.assert_allclose(gen.lebedev(degree=194), lebedev_grid_194)


def test_gauss_grid():
    # fmt: off
    gauss_grid_2_2 = io.SphericalGrid(
        azimuth=np.array([0., 0., np.pi, np.pi]),
        colatitude=np.array([0.9553166181245093, 2.1862760354652839, 2.1862760354652839, 0.9553166181245093]),
        radius=np.ones(4),
        weight=np.array([0.25, 0.25, 0.25, 0.25])
    )
    # fmt: on
    np.testing.assert_allclose(
        gen.gauss_grid(azimuth_nodes=2, colatitude_nodes=2), gauss_grid_2_2
    )
