

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sound_field_analysis.sph &mdash; Sound Field Analysis toolbox for Python 0.3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Sound Field Analysis toolbox for Python 0.3 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Sound Field Analysis toolbox for Python
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../processing.html">Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sound Field Analysis toolbox for Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>sound_field_analysis.sph</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for sound_field_analysis.sph</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Collection of spherical helper functions:</span>


<span class="sd">`sph_harm`</span>
<span class="sd">   More robust spherical harmonic coefficients</span>
<span class="sd">`spbessel / dspbessel`</span>
<span class="sd">   Spherical Bessel and derivative</span>
<span class="sd">`spneumann / dspneumann`</span>
<span class="sd">   Spherical Neumann (Bessel 2nd kind) and derivative</span>
<span class="sd">`sphankel / dsphankel`</span>
<span class="sd">   Spherical Hankel (second kind) and derivative</span>
<span class="sd">`cart2sph / sph2cart`</span>
<span class="sd">   Convert cartesion to spherical coordinates and vice versa</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">special</span> <span class="k">as</span> <span class="n">scy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">factorial</span> <span class="k">as</span> <span class="n">fact</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">scalar_broadcast_match</span>
<span class="kn">from</span> <span class="nn">.io</span> <span class="k">import</span> <span class="n">ArrayConfiguration</span>


<div class="viewcode-block" id="besselj"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.besselj">[docs]</a><span class="k">def</span> <span class="nf">besselj</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bessel function of first kind of order n at kr.</span>
<span class="sd">    Wraps scipy.special.jn(n, z).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    J : array_like</span>
<span class="sd">       Values of Bessel function of order n at position z</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scy</span><span class="o">.</span><span class="n">jv</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">(</span><span class="n">z</span><span class="p">))</span></div>


<div class="viewcode-block" id="neumann"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.neumann">[docs]</a><span class="k">def</span> <span class="nf">neumann</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bessel function of second kind (Neumann / Weber function) of order n at kr.</span>
<span class="sd">    Implemented as (hankel1(n, z) - besselj(n, z)) / 1j</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Y : array_like</span>
<span class="sd">       Values of Hankel function of order n at position z</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">hankel1</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">besselj</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1</span><span class="n">j</span></div>


<div class="viewcode-block" id="hankel1"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.hankel1">[docs]</a><span class="k">def</span> <span class="nf">hankel1</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bessel function of third kind (Hankel function) of order n at kr.</span>
<span class="sd">    Wraps scipy.special.hankel1(n, z)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    H1 : array_like</span>
<span class="sd">       Values of Hankel function of order n at position z</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scy</span><span class="o">.</span><span class="n">hankel1</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="hankel2"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.hankel2">[docs]</a><span class="k">def</span> <span class="nf">hankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bessel function of third kind (Hankel function) of order n at kr.</span>
<span class="sd">    Wraps scipy.special.hankel2(n, z)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    H2 : array_like</span>
<span class="sd">       Values of Hankel function of order n at position z</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scy</span><span class="o">.</span><span class="n">hankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="spbessel"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.spbessel">[docs]</a><span class="k">def</span> <span class="nf">spbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spherical Bessel function (first kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    J : complex float</span>
<span class="sd">       Spherical Bessel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">)</span>

        <span class="n">kr_non_zero</span> <span class="o">=</span> <span class="n">kr</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">J</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">scimath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">])</span> <span class="o">*</span> <span class="n">besselj</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">])</span>
        <span class="n">J</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">kr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">scy</span><span class="o">.</span><span class="n">spherical_jn</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span> <span class="n">kr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">J</span><span class="p">)</span></div>


<div class="viewcode-block" id="spneumann"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.spneumann">[docs]</a><span class="k">def</span> <span class="nf">spneumann</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spherical Neumann (Bessel second kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Yv : complex float</span>
<span class="sd">       Spherical Neumann (Bessel second kind)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">Yv</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">kr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">)</span>

        <span class="n">kr_non_zero</span> <span class="o">=</span> <span class="n">kr</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">Yv</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">scimath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">])</span> <span class="o">*</span> <span class="n">neumann</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_non_zero</span><span class="p">])</span>
        <span class="n">Yv</span><span class="p">[</span><span class="n">kr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Yv</span><span class="p">[</span><span class="n">kr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Yv</span> <span class="o">=</span> <span class="n">scy</span><span class="o">.</span><span class="n">spherical_yn</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span> <span class="n">kr</span><span class="p">)</span>
        <span class="n">Yv</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">Yv</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># return possible infs as nan to stay consistent</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Yv</span><span class="p">)</span></div>


<div class="viewcode-block" id="sphankel1"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.sphankel1">[docs]</a><span class="k">def</span> <span class="nf">sphankel1</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spherical Hankel (first kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hn1 : complex float</span>
<span class="sd">       Spherical Hankel function hn (first kind)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>
    <span class="n">hn1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">)</span>
    <span class="n">kr_nonzero</span> <span class="o">=</span> <span class="n">kr</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">hn1</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">scimath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">*</span> <span class="n">hankel1</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">hn1</span></div>


<div class="viewcode-block" id="sphankel2"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.sphankel2">[docs]</a><span class="k">def</span> <span class="nf">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spherical Hankel (second kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hn2 : complex float</span>
<span class="sd">       Spherical Hankel function hn (second kind)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>
    <span class="n">hn2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">)</span>
    <span class="n">kr_nonzero</span> <span class="o">=</span> <span class="n">kr</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">hn2</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">scimath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">*</span> <span class="n">hankel2</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">hn2</span></div>


<div class="viewcode-block" id="dspbessel"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.dspbessel">[docs]</a><span class="k">def</span> <span class="nf">dspbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Derivative of spherical Bessel (first kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    J&#39; : complex float</span>
<span class="sd">       Derivative of spherical Bessel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="n">spbessel</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spbessel</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="dspneumann"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.dspneumann">[docs]</a><span class="k">def</span> <span class="nf">dspneumann</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Derivative spherical Neumann (Bessel second kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Yv&#39; : complex float</span>
<span class="sd">       Derivative of spherical Neumann (Bessel second kind)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">kr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">spneumann</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">kr</span> <span class="o">-</span> <span class="n">spneumann</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">scy</span><span class="o">.</span><span class="n">spherical_yn</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span> <span class="n">kr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">complex</span><span class="p">),</span> <span class="n">derivative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="dsphankel1"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.dsphankel1">[docs]</a><span class="k">def</span> <span class="nf">dsphankel1</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Derivative spherical Hankel (first kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dhn1 : complex float</span>
<span class="sd">       Derivative of spherical Hankel function hn&#39; (second kind)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>
    <span class="n">dhn1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">)</span>
    <span class="n">kr_nonzero</span> <span class="o">=</span> <span class="n">kr</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">dhn1</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sphankel1</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">-</span> <span class="n">sphankel1</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">-</span> <span class="n">sphankel1</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">],</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">/</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dhn1</span></div>


<div class="viewcode-block" id="dsphankel2"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.dsphankel2">[docs]</a><span class="k">def</span> <span class="nf">dsphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Derivative spherical Hankel (second kind) of order n at kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : array_like</span>
<span class="sd">       Order</span>
<span class="sd">    kr: array_like</span>
<span class="sd">       Argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dhn2 : complex float</span>
<span class="sd">       Derivative of spherical Hankel function hn&#39; (second kind)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">kr</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr</span><span class="p">)</span>
    <span class="n">dhn2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex_</span><span class="p">)</span>
    <span class="n">kr_nonzero</span> <span class="o">=</span> <span class="n">kr</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">dhn2</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">-</span> <span class="n">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">-</span> <span class="n">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">],</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span> <span class="o">/</span> <span class="n">kr</span><span class="p">[</span><span class="n">kr_nonzero</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dhn2</span></div>


<div class="viewcode-block" id="spherical_extrapolation"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.spherical_extrapolation">[docs]</a><span class="k">def</span> <span class="nf">spherical_extrapolation</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">array_configuration</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k_dual</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Factor that relate signals recorded on a sphere to it&#39;s center.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    order : int</span>
<span class="sd">       Order</span>
<span class="sd">    array_configuration : ArrayConfiguration</span>
<span class="sd">       List/Tuple/ArrayConfiguration, see io.ArrayConfiguration</span>
<span class="sd">    k_mic : array_like</span>
<span class="sd">       K vector for microphone array</span>
<span class="sd">    k_scatter: array_like, optional</span>
<span class="sd">       K vector for scatterer  (Default: same as k_mic)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    b : array, complex</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array_configuration</span> <span class="o">=</span> <span class="n">ArrayConfiguration</span><span class="p">(</span><span class="o">*</span><span class="n">array_configuration</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_type</span> <span class="ow">is</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">transducer_type</span> <span class="ow">is</span> <span class="s1">&#39;omni&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bn_open_omni</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">transducer_type</span> <span class="ow">is</span> <span class="s1">&#39;cardioid&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bn_open_cardioid</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_type</span> <span class="ow">is</span> <span class="s1">&#39;rigid&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">transducer_type</span> <span class="ow">is</span> <span class="s1">&#39;omni&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bn_rigid_omni</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">transducer_type</span> <span class="ow">is</span> <span class="s1">&#39;cardioid&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bn_rigid_cardioid</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_type</span> <span class="ow">is</span> <span class="s1">&#39;dual&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bn_dual_open_omni</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_dual</span><span class="p">)</span></div>


<div class="viewcode-block" id="array_extrapolation"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.array_extrapolation">[docs]</a><span class="k">def</span> <span class="nf">array_extrapolation</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">array_configuration</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Factor that relate signals recorded on a sphere to it&#39;s center.</span>
<span class="sd">    In the rigid configuration, a scatter_radius that is different to the array radius may be set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    order : int</span>
<span class="sd">       Order</span>
<span class="sd">    freqs : array_like</span>
<span class="sd">       Frequencies</span>
<span class="sd">    array_configuration : ArrayConfiguration</span>
<span class="sd">       List/Tuple/ArrayConfiguration, see io.ArrayConfiguration</span>
<span class="sd">    normalize: Bool, optional</span>
<span class="sd">        Normalize by 4 * pi * 1j ** order (Default: True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    b : array, complex</span>
<span class="sd">       Coefficients of shape [nOrder x nFreqs]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">array_configuration</span> <span class="o">=</span> <span class="n">ArrayConfiguration</span><span class="p">(</span><span class="o">*</span><span class="n">array_configuration</span><span class="p">)</span>

    <span class="n">freqs</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">k_mic</span> <span class="o">=</span> <span class="n">kr</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_radius</span><span class="p">)</span>
    <span class="n">k_scatter</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">k_dual</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">**</span> <span class="n">order</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_type</span> <span class="ow">is</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
        <span class="n">k_scatter</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_type</span> <span class="ow">is</span> <span class="s1">&#39;rigid&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">scatter_radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scatter_radius</span> <span class="o">=</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_radius</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scatter_radius</span> <span class="o">=</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">scatter_radius</span>
        <span class="n">k_scatter</span> <span class="o">=</span> <span class="n">kr</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">scatter_radius</span><span class="p">)</span>

        <span class="c1"># Replace leading k==0 with the next element to avoid nan</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">k_mic</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">k_mic</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_mic</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">k_scatter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">k_scatter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_scatter</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">array_type</span> <span class="ow">is</span> <span class="s1">&#39;dual&#39;</span><span class="p">:</span>
        <span class="n">k_dual</span> <span class="o">=</span> <span class="n">kr</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">array_configuration</span><span class="o">.</span><span class="n">dual_radius</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">spherical_extrapolation</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">array_configuration</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">,</span> <span class="n">k_dual</span><span class="p">)</span></div>


<div class="viewcode-block" id="bn_open_omni"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.bn_open_omni">[docs]</a><span class="k">def</span> <span class="nf">bn_open_omni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">spbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span></div>


<div class="viewcode-block" id="bn_open_cardioid"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.bn_open_cardioid">[docs]</a><span class="k">def</span> <span class="nf">bn_open_cardioid</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">spbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dspbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">))</span></div>


<div class="viewcode-block" id="bn_rigid_omni"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.bn_rigid_omni">[docs]</a><span class="k">def</span> <span class="nf">bn_rigid_omni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">,</span> <span class="n">krs</span><span class="p">):</span>
    <span class="n">krm</span><span class="p">,</span> <span class="n">krs</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">krm</span><span class="p">,</span> <span class="n">krs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">dspbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krs</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krs</span><span class="p">))</span> <span class="o">*</span> <span class="n">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span></div>


<div class="viewcode-block" id="bn_rigid_cardioid"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.bn_rigid_cardioid">[docs]</a><span class="k">def</span> <span class="nf">bn_rigid_cardioid</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">,</span> <span class="n">krs</span><span class="p">):</span>
    <span class="c1">#  Rerence for Filter design for rigid sphere with cardioid microphones:</span>
    <span class="c1">#  P. Plessas, F. Zotter: Microphone arrays around rigid spheres for spatial recording and holography, DAGA 2010</span>
    <span class="c1">#  krm: for mic radius, krs: for sphere radius</span>
    <span class="n">krm</span><span class="p">,</span> <span class="n">krs</span> <span class="o">=</span> <span class="n">scalar_broadcast_match</span><span class="p">(</span><span class="n">krm</span><span class="p">,</span> <span class="n">krs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dspbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dsphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">)</span> <span class="o">-</span> <span class="n">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krm</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">dspbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krs</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">krs</span><span class="p">))</span></div>


<div class="viewcode-block" id="bn_dual_open_omni"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.bn_dual_open_omni">[docs]</a><span class="k">def</span> <span class="nf">bn_dual_open_omni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr1</span><span class="p">,</span> <span class="n">kr2</span><span class="p">):</span>
    <span class="c1"># Reference: Rafaely et al,</span>
    <span class="c1">#  High-resolution plane-wave decomposition in an auditorium using a dual-radius scanning spherical microphone array</span>
    <span class="c1">#  JASA, 122(5), 2007</span>
    <span class="c1"># kr1, kr2 are the kr values of the two different microphone spheres</span>
    <span class="c1"># Implementation by Nils Peters, November 2011*/</span>
    <span class="n">bn1</span> <span class="o">=</span> <span class="n">bn_open_omni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr1</span><span class="p">)</span>
    <span class="n">bn2</span> <span class="o">=</span> <span class="n">bn_open_omni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kr2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bn1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bn2</span><span class="p">),</span> <span class="n">bn1</span><span class="p">,</span> <span class="n">bn2</span><span class="p">)</span></div>


<div class="viewcode-block" id="sph_harm"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.sph_harm">[docs]</a><span class="k">def</span> <span class="nf">sph_harm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;complex&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute sphercial harmonics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : (int)</span>
<span class="sd">        Order of the spherical harmonic. abs(m) &lt;= n</span>

<span class="sd">    n : (int)</span>
<span class="sd">        Degree of the harmonic, sometimes called l. n &gt;= 0</span>

<span class="sd">    az: (float)</span>
<span class="sd">        Azimuthal (longitudinal) coordinate [0, 2pi], also called Theta.</span>

<span class="sd">    el : (float)</span>
<span class="sd">        Elevation (colatitudinal) coordinate [0, pi], also called Phi.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y_mn : (complex float)</span>
<span class="sd">        Complex spherical harmonic of order m and degree n,</span>
<span class="sd">        sampled at theta = az, phi = el</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;legacy&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">scy</span><span class="o">.</span><span class="n">sph_harm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">Lnm</span> <span class="o">=</span> <span class="n">scy</span><span class="o">.</span><span class="n">lpmv</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>

        <span class="n">factor_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">factor_2</span> <span class="o">=</span> <span class="n">scy</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="o">/</span> <span class="n">scy</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">factor_1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">factor_1</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">m</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">factor_1</span> <span class="o">*</span> <span class="n">factor_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lnm</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">az</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">m</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">factor_1</span> <span class="o">*</span> <span class="n">factor_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lnm</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">az</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For the correct CondonShortley phase, all m&gt;0 need to be increased by 1</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">_np</span><span class="o">.</span><span class="n">float_</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">scy</span><span class="o">.</span><span class="n">sph_harm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span></div>


<div class="viewcode-block" id="sph_harm_large"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.sph_harm_large">[docs]</a><span class="k">def</span> <span class="nf">sph_harm_large</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute sphercial harmonics for large orders &gt; 84</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : (int)</span>
<span class="sd">        Order of the spherical harmonic. abs(m) &lt;= n</span>

<span class="sd">    n : (int)</span>
<span class="sd">        Degree of the harmonic, sometimes called l. n &gt;= 0</span>

<span class="sd">    az: (float)</span>
<span class="sd">        Azimuthal (longitudinal) coordinate [0, 2pi], also called Theta.</span>

<span class="sd">    el : (float)</span>
<span class="sd">        Elevation (colatitudinal) coordinate [0, pi], also called Phi.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y_mn : (complex float)</span>
<span class="sd">        Complex spherical harmonic of order m and degree n,</span>
<span class="sd">        sampled at theta = az, phi = el</span>

<span class="sd">    Y_n,m (theta, phi) = ((n - m)! * (2l + 1)) / (4pi * (l + m))^0.5 * exp(i m phi) * P_n^m(cos(theta))</span>
<span class="sd">    as per http://dlmf.nist.gov/14.30</span>
<span class="sd">    Pmn(z) is the associated Legendre function of the first kind, like scipy.special.lpmv</span>
<span class="sd">    scipy.special.lpmn calculates P(0...m 0...n) and its derivative but won&#39;t return +inf at high orders</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">84</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scy</span><span class="o">.</span><span class="n">sph_harm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mAbs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scy</span><span class="o">.</span><span class="n">lpmn</span><span class="p">(</span><span class="n">mAbs</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="n">k</span><span class="p">]))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">scy</span><span class="o">.</span><span class="n">lpmn</span><span class="p">(</span><span class="n">mAbs</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">preFactor1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">preFactor2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fact</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">mAbs</span><span class="p">)</span> <span class="o">/</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">mAbs</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>  <span class="c1"># integer division for very large orders</span>
            <span class="n">preFactor2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fact</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">mAbs</span><span class="p">)</span> <span class="o">//</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">mAbs</span><span class="p">))</span>

        <span class="n">Y</span> <span class="o">=</span> <span class="n">preFactor1</span> <span class="o">*</span> <span class="n">preFactor2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">az</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Y</span></div>


<div class="viewcode-block" id="sph_harm_all"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.sph_harm_all">[docs]</a><span class="k">def</span> <span class="nf">sph_harm_all</span><span class="p">(</span><span class="n">nMax</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;complex&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute all sphercial harmonic coefficients up to degree nMax.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nMax : (int)</span>
<span class="sd">        Maximum degree of coefficients to be returned. n &gt;= 0</span>

<span class="sd">    az: (float), array_like</span>
<span class="sd">        Azimuthal (longitudinal) coordinate [0, 2pi], also called Theta.</span>

<span class="sd">    el : (float), array_like</span>
<span class="sd">        Elevation (colatitudinal) coordinate [0, pi], also called Phi.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y_mn : (complex float), array_like</span>
<span class="sd">        Complex spherical harmonics of degrees n [0 ... nMax] and all corresponding</span>
<span class="sd">        orders m [-n ... n], sampled at [az, el]. dim1 corresponds to az/el pairs,</span>
<span class="sd">        dim2 to oder/degree (m, n) pairs like 0/0, -1/1, 0/1, 1/1, -2/2, -1/2 ...</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">mnArrays</span><span class="p">(</span><span class="n">nMax</span><span class="p">)</span>
    <span class="n">mA</span><span class="p">,</span> <span class="n">azA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">az</span><span class="p">)</span>
    <span class="n">nA</span><span class="p">,</span> <span class="n">elA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sph_harm</span><span class="p">(</span><span class="n">mA</span><span class="p">,</span> <span class="n">nA</span><span class="p">,</span> <span class="n">azA</span><span class="p">,</span> <span class="n">elA</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span></div>


<div class="viewcode-block" id="mnArrays"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.mnArrays">[docs]</a><span class="k">def</span> <span class="nf">mnArrays</span><span class="p">(</span><span class="n">nMax</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns degrees n and orders m up to nMax.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nMax : (int)</span>
<span class="sd">        Maximum degree of coefficients to be returned. n &gt;= 0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m : (int), array_like</span>
<span class="sd">        0, -1, 0, 1, -2, -1, 0, 1, 2, ... , -nMax ..., nMax</span>
<span class="sd">    n : (int), array_like</span>
<span class="sd">        0, 1, 1, 1, 2, 2, 2, 2, 2, ... nMax, nMax, nMax</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Degree n = 0, 1, 1, 1, 2, 2, 2, 2, 2 ...</span>
    <span class="n">degs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nMax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">degs</span><span class="p">,</span> <span class="n">degs</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Order m = 0, -1, 1, 1, -2, -1, 0, 1, 2 ...</span>
    <span class="c1"># http://oeis.org/A196199</span>
    <span class="n">elementNumber</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="n">nMax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">elementNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">elementNumber</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span></div>


<div class="viewcode-block" id="cart2sph"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.cart2sph">[docs]</a><span class="k">def</span> <span class="nf">cart2sph</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Converts cartesian coordinates x, y, z to spherical coordinates az, el, r.&#39;&#39;&#39;</span>
    <span class="n">hxy</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">hxy</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">el</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">hxy</span><span class="p">)</span>
    <span class="n">az</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">r</span></div>


<div class="viewcode-block" id="sph2cart"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.sph2cart">[docs]</a><span class="k">def</span> <span class="nf">sph2cart</span><span class="p">(</span><span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Converts spherical coordinates az, el, r to cartesian coordinates x, y, z.&#39;&#39;&#39;</span>
    <span class="n">rcos_theta</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rcos_theta</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rcos_theta</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>


<div class="viewcode-block" id="kr"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.kr">[docs]</a><span class="k">def</span> <span class="nf">kr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return kr vector for given f and array radius</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f : array_like</span>
<span class="sd">       Frequencies to calculate the kr for</span>
<span class="sd">    radius : float</span>
<span class="sd">       Radius of array</span>
<span class="sd">    temperature : float, optional</span>
<span class="sd">       Room temperature in degree Celcius [Default: 20]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kr : array_like</span>
<span class="sd">       2 * pi * f / c(temperatur) * r</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">331.5</span> <span class="o">+</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span></div>


<div class="viewcode-block" id="kr_full_spec"><a class="viewcode-back" href="../../reference.html#sound_field_analysis.sph.kr_full_spec">[docs]</a><span class="k">def</span> <span class="nf">kr_full_spec</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">NFFT</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns full spectrum kr</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fs : int</span>
<span class="sd">       Sampling rate in Hertz</span>
<span class="sd">    radius : float</span>
<span class="sd">       Radius</span>
<span class="sd">    NFFT : int</span>
<span class="sd">       Number of frequency bins</span>
<span class="sd">    temperature : float, optional</span>
<span class="sd">       Temperature in degree Celcius (Default: 20 C)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kr : array_like</span>
<span class="sd">       kr vector of length NFFT/2 + 1 spanning the frequencies of 0:fs/2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">NFFT</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kr</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span></div>

<span class="c1"># DEBUG</span>
<span class="k">def</span> <span class="nf">_print_bessel_functions</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bessel:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">besselj</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;hankel2:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">hankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;spbessel:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">spbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;dspbessel:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dspbessel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;spneumann:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">spneumann</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;dspneumann:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dspneumann</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;sphankel2:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">sphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;dsphankel2:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dsphankel2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)))))</span>


<span class="k">def</span> <span class="nf">_print_mic_scaling</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">array_radius</span><span class="p">,</span> <span class="n">scatter_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dual_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">scatter_radius</span><span class="p">:</span>
        <span class="n">scatter_radius</span> <span class="o">=</span> <span class="n">array_radius</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dual_radius</span><span class="p">:</span>
        <span class="n">dual_radius</span> <span class="o">=</span> <span class="n">array_radius</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_open_omni:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">array_extrapolation</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="p">[</span><span class="n">array_radius</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;omni&#39;</span><span class="p">])))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_open_cardioid:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">array_extrapolation</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="p">[</span><span class="n">array_radius</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;cardioid&#39;</span><span class="p">])))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_rigid_omni:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">array_extrapolation</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="p">[</span><span class="n">array_radius</span><span class="p">,</span> <span class="s1">&#39;rigid&#39;</span><span class="p">,</span> <span class="s1">&#39;omni&#39;</span><span class="p">,</span> <span class="n">scatter_radius</span><span class="p">])))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_rigid_cardioid:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">array_extrapolation</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="p">[</span><span class="n">array_radius</span><span class="p">,</span> <span class="s1">&#39;rigid&#39;</span><span class="p">,</span> <span class="s1">&#39;cardioid&#39;</span><span class="p">,</span> <span class="n">scatter_radius</span><span class="p">])))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_dual_open_omni:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">array_extrapolation</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="p">[</span><span class="n">array_radius</span><span class="p">,</span> <span class="s1">&#39;dual&#39;</span><span class="p">,</span> <span class="s1">&#39;omni&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dual_radius</span><span class="p">])))))</span>


<span class="k">def</span> <span class="nf">_print_bns</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_open_omni:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bn_open_omni</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="o">**</span><span class="n">N</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_open_cardioid:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bn_open_cardioid</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="o">**</span><span class="n">N</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_rigid_omni:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bn_rigid_omni</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="o">**</span><span class="n">N</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_rigid_cardioid:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bn_rigid_cardioid</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="o">**</span><span class="n">N</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;bn_dual_open_omni:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bn_dual_open_omni</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k_mic</span><span class="p">,</span> <span class="n">k_scatter</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="o">**</span><span class="n">N</span><span class="p">))))</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Christoph Hohnerlein (QU Lab).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>